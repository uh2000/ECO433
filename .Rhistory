```{r}
df_no  <- read_excel("norway_final.xlsx")
df_den <- read_excel("denmark_final.xlsx")
library(readxl)
df_den <- read_excel("denmark_final.xlsx")
df_no  <- read_excel("norway_final.xlsx")
library(dplyr)
# Select only numeric columns and sum each column
df_den_summed <- df_den |> dplyr::select(where(is.numeric)) |> colSums()
df_no_summed  <- df_no  |> dplyr::select(where(is.numeric)) |> colSums()
library(dplyr)
library(tidyr)
# Convert summed vectors to data frames and add metadata
df_den_total <- as.data.frame(t(df_den_summed)) |>
tibble::rownames_to_column(var = "Variable") |>
tidyr::pivot_wider(names_from = Variable, values_from = V1) |>
mutate(Country = "Denmark") |>
relocate(Country)
library(dplyr)
library(tidyr)
library(tibble)
# Convert summed named vector to one-row data frame and add metadata
df_den_total <- as.data.frame(as.list(df_den_summed)) |>
mutate(Country = "Denmark") |>
relocate(Country)
df_no_total <- as.data.frame(as.list(df_no_summed)) |>
mutate(Country = "Norway") |>
relocate(Country)
# Ensure all column names are strings
names(df_den_total) <- c("Country", as.character(names(df_den_total)[-1]))
names(df_no_total)  <- c("Country", as.character(names(df_no_total)[-1]))
# Find common columns
den_cols <- setdiff(names(df_den_total), "Country")
no_cols  <- setdiff(names(df_no_total), "Country")
common_cols <- sort(intersect(den_cols, no_cols))
# Reorder both to same structure
df_den_aligned <- df_den_total |> select(Country, all_of(common_cols))
df_no_aligned  <- df_no_total  |> select(Country, all_of(common_cols))
# Combine them
df_combined <- bind_rows(df_den_aligned, df_no_aligned)
cat("Combined (no NA):\n")
print(df_combined)
# Melt to long format for regression
df_long <- df_combined |>
pivot_longer(
cols = -Country,
names_to = "Year",
values_to = "Cases"
) |>
drop_na()
cat("\nLong format data (after dropping NA):\n")
print(head(df_long, 20))
# Convert year to numeric and create policy variables
df_long <- df_long |>
mutate(
Year = as.numeric(Year),
Post_2004 = as.integer(Year >= 2004),
Norway = as.integer(Country == "Norway"),
Treated = Norway * Post_2004
)
cat("\nFinal data for DiD regression:\n")
print(head(df_long, 20))
# Difference-in-Differences regression
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
nrow(df_long)
colSums(is.na(df_long))
print(df_den_summed)
print(df_no_summed)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
# Difference-in-Differences regression
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
nrow(df_long)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
print(df_combined)
str(df_combined)
df_den <- df_den |> mutate(across(where(is.character), readr::parse_number))
df_no  <- df_no  |> mutate(across(where(is.character), readr::parse_number))
print(df_combined)
str(df_combined)
# Remove the 'X' prefix from year columns
names(df_combined) <- gsub("^X", "", names(df_combined))
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
# Melt to long format for regression
df_long <- df_combined |>
pivot_longer(
cols = -Country,
names_to = "Year",
values_to = "Cases"
) |>
drop_na() |>
mutate(
Year = as.numeric(Year),
Post_2004 = as.integer(Year >= 2004),
Norway = as.integer(Country == "Norway"),
Treated = Norway * Post_2004
)
# Run the Difference-in-Differences regression
did_model <- lm(Cases ~ Treated + Post_2004 + Norway, data = df_long)
summary(did_model)
library(tidyr)
library(tibble)
# Convert summed named vector to one-row data frame and add metadata
df_den_total <- as.data.frame(as.list(df_den_summed)) |>
mutate(Country = "Denmark") |>
relocate(Country)
df_no_total <- as.data.frame(as.list(df_no_summed)) |>
mutate(Country = "Norway") |>
relocate(Country)
# Ensure all column names are strings
names(df_den_total) <- c("Country", as.character(names(df_den_total)[-1]))
names(df_no_total)  <- c("Country", as.character(names(df_no_total)[-1]))
# Find common columns
den_cols <- setdiff(names(df_den_total), "Country")
no_cols  <- setdiff(names(df_no_total), "Country")
common_cols <- sort(intersect(den_cols, no_cols))
# Reorder both to same structure
df_den_aligned <- df_den_total |> select(Country, all_of(common_cols))
df_no_aligned  <- df_no_total  |> select(Country, all_of(common_cols))
# Combine them
df_combined <- bind_rows(df_den_aligned, df_no_aligned)
cat("Combined (no NA):\n")
print(df_combined)
# Melt to long format for regression
df_long <- df_combined |>
pivot_longer(
cols = -Country,
names_to = "Year",
values_to = "Cases"
) |>
drop_na()
cat("\nLong format data (after dropping NA):\n")
print(head(df_long, 20))
# Convert year to numeric and create policy variables
df_long <- df_long |>
mutate(
Year = as.numeric(Year),
Post_2004 = as.integer(Year >= 2004),
Norway = as.integer(Country == "Norway"),
Treated = Norway * Post_2004
)
cat("\nFinal data for DiD regression:\n")
print(head(df_long, 20))
